<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お客様の情報登録確認ページ</title>
    <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
    <!-- vue と elementUIの依存css -->
    <link rel="stylesheet" href="./css/element-ui-min.css">
    
    <link href="./css/common.css" rel="stylesheet" />
    
    <!-- vue と elementUIの依存javascript -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://unpkg.com/element-ui/lib/umd/locale/ja.js"></script>

</head>
<body >
    <!-- ヘッドの部分 各々の画面は同じです -->
    <header class="common-header">
        <div class="logo">
            ブリッジ
        </div>
        <div class="login-info">
            未登録
        </div>
    </header>

    <!-- メインの部分 -->
    <main class="common-mian common-mian-nologin" id="app" v-cloak>
        <!-- お客様の登録 -->
        <section class="login-form-container">
            <div class="caption">
                お客様の情報登録確認
            </div>
            <div class="login-infos-wrapper">
                <div class="info-item">
                    <label class="label"  for="">
                        ユーザ名: 
                    </label>
                    <div>{{customerInfo.username}}</div>
                </div>
                <div class="info-item">
                    <label class="label"  for="">
                        氏&nbsp;&nbsp;名: 
                    </label>
                    <div>{{customerInfo.name}}</div>
                </div>
                <div class="info-item">
                    <label class="label"  for="">
                        TEL: 
                    </label>
                    <div>{{customerInfo.tel}}</div>
                </div>
                <div class="info-item">
                    <label class="label"  for="">
                        Email: 
                    </label>
                    <div>{{customerInfo.email}}</div>
                </div>
                <div class="info-item">
                    <label class="label" for="">
                        住所:
                    </label>
                    <div>
                        <div>〒{{customerInfo.zipcode}}</div>
                        <div>{{customerInfo.addr1}}&nbsp;&nbsp;
                            {{customerInfo.addr2}}&nbsp;&nbsp;
                            {{customerInfo.addr3}}&nbsp;&nbsp;
                            {{customerInfo.addr4}}
                        </div>
                    </div>
                </div>
                <div class="info-item info-item-btn">
                    <div class="conf-btn">
                        <el-button type="primary" @click="onRegister">確認して登録する</el-button>
                    </div>
                    <div>
                        <el-button type="info" @click="toEdit">修正に戻る</el-button>
                    </div>
                </div>
            </div>
        </section>
    </main>
</body>
</html>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="./js/pageJump.js"></script>
<script>
	// elementの日本語対応
    ELEMENT.locale(ELEMENT.lang.ja); 
       
    let vm;
    vm = new Vue({

        // id はapp の属性の中の部分を管理する
        el: "#app",
        data(){
            return {
                // html の中の　v-model　属性と同じ値
                customerInfo: {
                    username: "",
                    name: "",
                    tel: "",
                    email: "",
				},
                caseInfo: {}
            };
        },
        mounted() {
            const customerInfoStr = localStorage.getItem("tempCustomerInfo");
            const customerInfo = JSON.parse(customerInfoStr);
            this.customerInfo = customerInfo;
        },
        methods: {
            toEdit() {
                window.location.href = "customerRegister.html";
            },
            onRegister() {
                const loading = this.$loading({
                    lock: true,
                    text: 'Loading',
                    spinner: 'el-icon-loading',
                    background: 'rgba(0, 0, 0, 0.1)'
                });
                axios({
                    method: "POST",
                    url: "/register/cst/save",
                    data: {
                        type: 1,
                        ...this.customerInfo
                    },
                    withCredentials: true
                })
                    .then((res = {}) => {
                        loading.close();
                        const { data: { code } = {} } = res;
                        if (code == 90010) {
                            this.$message.error('現在、登録できません、少し後でもう一度お試してください');
                        } else {
                            this.$message.success('登録しました');
                            localStorage.removeItem("tempCustomerInfo");
                            setTimeout(() => {
                                goCustomerRegisterComplete();
                            }, 1000);
                        }
                    });
                
                
            },
        }
    });
</script>